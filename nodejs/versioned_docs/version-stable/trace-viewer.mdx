---
id: trace-viewer
title: "追蹤檢視器"
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import HTMLCard from '@site/src/components/HTMLCard';
import ProgressiveImage from '@theme/ProgressiveImage';

import LiteYouTube from '@site/src/components/LiteYouTube';

## 簡介

Playwright Trace Viewer 是一個 GUI 工具，可以幫助您在腳本執行後探索記錄的 Playwright 追蹤。追蹤是在 CI 上測試失敗時進行偵錯的好方法。您可以在[本地](#opening-the-trace)或在瀏覽器上 [trace.playwright.dev](https://trace.playwright.dev) 打開追蹤。

###### 
<LiteYouTube id="yP6AnTxC34s" title="Viewing Playwright Traces" />

## 開啟 Trace Viewer

您可以使用 Playwright CLI 或在瀏覽器 [trace.playwright.dev](https://trace.playwright.dev) 中開啟已儲存的追蹤。請確保加入 `trace.zip` 檔案所在位置的完整路徑。

```bash
npx playwright show-trace path/to/trace.zip
```

### 使用 [trace.playwright.dev](https://trace.playwright.dev)

[trace.playwright.dev](https://trace.playwright.dev) 是 Trace Viewer 的靜態託管版本。您可以使用拖放功能或透過 `Select file(s)` 按鈕上傳追蹤檔案。

Trace Viewer 會將追蹤完全載入您的瀏覽器中，不會對外傳輸任何資料。

<img width="1119" alt="Drop Playwright Trace to load" src="https://user-images.githubusercontent.com/13063165/194577918-b4d45726-2692-4093-8a28-9e73552617ef.png" />

### 查看遠端追蹤

您可以使用其 URL 直接開啟遠端追蹤。這讓您可以輕鬆查看遠端追蹤，而無需手動從 CI 執行中下載檔案，例如。

```bash
npx playwright show-trace https://example.com/trace.zip
```

當使用 [trace.playwright.dev](https://trace.playwright.dev) 時，您也可以將上傳追蹤的 URL 作為查詢參數傳遞到某個可存取的儲存位置（例如在您的 CI 內）。可能會適用 CORS（跨來源資源共享）規則。

```txt
https://trace.playwright.dev/?trace=https://demo.playwright.dev/reports/todomvc/data/fa874b0d59cdedec675521c21124e93161d66533.zip
```

## 錄製追蹤

### 本地追蹤

要在開發模式下記錄追蹤，請在執行測試時將 `--trace` 標誌設定為 `on`。您也可以使用 [UI Mode](./test-ui-mode.mdx) 以獲得更好的開發者體驗，因為它會自動追蹤每個測試。

```bash
npx playwright test --trace on
```

然後您可以開啟 HTML 報告並點擊追蹤圖示來開啟追蹤。

```bash
npx playwright show-report
```

### 在 CI 上追蹤

追蹤應該在持續整合上於失敗測試的第一次重試時執行，方法是在測試設定檔中設定 `trace: 'on-first-retry'` 選項。這將為每個重試的測試產生一個 `trace.zip` 檔案。

<Tabs
  groupId="js-flavor"
  defaultValue="test"
  values={[
    {label: 'Test', value: 'test'},
    {label: 'Library', value: 'library'}
  ]
}>
<TabItem value="test">

```js title="playwright.config.ts"
import { defineConfig } from '@playwright/test';
export default defineConfig({
  retries: 1,
  use: {
    trace: 'on-first-retry',
  },
});
```

</TabItem>
<TabItem value="library">

```js
const browser = await chromium.launch();
const context = await browser.newContext();

// Start tracing before creating / navigating a page.
await context.tracing.start({ screenshots: true, snapshots: true });

const page = await context.newPage();
await page.goto('https://playwright.dev');

// Stop tracing and export it into a zip archive.
await context.tracing.stop({ path: 'trace.zip' });
```

</TabItem>
</Tabs>

錄製追蹤的可用選項：
- `'on-first-retry'` - 僅在第一次重試測試時記錄追蹤。
- `'on-all-retries'` - 為所有測試重試記錄追蹤。
- `'off'` - 不記錄追蹤。
- `'on'` - 為每個測試記錄追蹤。（不建議，因為會影響效能）
- `'retain-on-failure'` - 為每個測試記錄追蹤，但從成功的測試執行中移除。

如果您沒有啟用重試但仍想要失敗測試的追蹤，您也可以使用 `trace: 'retain-on-failure'`。

還有更細粒度的選項可用，請參見 [testOptions.trace](/api/class-testoptions.mdx#test-options-trace)。

如果您沒有使用 Playwright 作為測試執行器，請改用 [browserContext.tracing](/api/class-browsercontext.mdx#browser-context-tracing) API。

## Trace Viewer 功能

### Actions

在 Actions 分頁中，您可以看到每個動作使用的定位器以及每個動作執行的時間。懸停在測試的每個動作上，視覺化地查看 DOM 快照的變化。前後移動時間並點擊動作進行檢查和偵錯。使用 Before 和 After 分頁視覺化地查看動作前後發生的情況。

![actions tab in trace viewer](https://github.com/microsoft/playwright/assets/13063165/948b65cd-f0fd-4c7f-8e53-2c632b5a07f1)

**選擇每個動作會顯示：**
- 動作快照
- 動作日誌
- 原始程式碼位置

### 螢幕截圖

當使用 [screenshots](/api/class-tracing.mdx#tracing-start-option-screenshots) 選項開啟追蹤時（預設），每個追蹤會記錄螢幕錄影並將其呈現為膠片條。您可以懸停在膠片條上查看每個動作和狀態的放大影像，這有助於您輕鬆找到要檢查的動作。

雙擊動作可查看該動作的時間範圍。您可以使用時間軸中的滑桿增加選擇的動作，這些動作將顯示在 Actions 分頁中，所有主控台日誌和網路日誌都會被篩選為僅顯示所選動作的日誌。

![timeline view in trace viewer](https://github.com/microsoft/playwright/assets/13063165/b04a7d75-54bb-4ab2-9e30-e76f6f74a2c8)

### 快照

當使用 [snapshots](/api/class-tracing.mdx#tracing-start-option-snapshots) 選項開啟追蹤時（預設），Playwright 會為每個動作捕獲一組完整的 DOM 快照。根據動作的類型，它將捕獲：

| Type | Description |
|------|-------------|
|Before|動作呼叫時的快照。|
|Action|執行輸入時刻的快照。此類型的快照特別有用於探索 Playwright 確切點擊的位置。|
|After|動作後的快照。|

這是典型的 Action 快照外觀：

![action tab in trace viewer](https://github.com/microsoft/playwright/assets/13063165/7168d549-eb0a-4964-9c93-483f03711fa9)

注意它如何同時突出顯示 DOM Node 以及確切的點擊位置。

### Source

當您點擊側邊欄中的動作時，該動作的程式碼行會在原始碼面板中突出顯示。

![showing source code tab in trace viewer](https://github.com/microsoft/playwright/assets/13063165/daa8845d-c250-4923-aa7a-5d040da9adc5)

### Call

call 分頁顯示有關動作的資訊，例如執行時間、使用的定位器、是否在嚴格模式下以及使用的鍵。

![showing call tab in trace viewer](https://github.com/microsoft/playwright/assets/13063165/95498580-f9dd-4932-a123-c37fe7cfc3c2)

### Log

查看完整的測試日誌，以更好地了解 Playwright 在幕後執行的操作，例如滾動到檢視中、等待元素可見、啟用和穩定，以及執行點擊、填寫、按壓等動作。

![showing log of tests in trace viewer](https://github.com/microsoft/playwright/assets/13063165/de621461-3bab-4140-b39d-9f02d6672dbf)

### Errors

如果測試失敗，您將在 Errors 分頁中看到每個測試的錯誤訊息。時間軸也會顯示一條紅線，突出顯示錯誤發生的位置。您也可以點擊 source 分頁查看錯誤出現在原始程式碼的哪一行。

![showing errors in trace viewer](https://github.com/microsoft/playwright/assets/13063165/e9ef77b3-05d1-4df2-852c-981023723d34)

### Console

請查看來自瀏覽器以及測試的主控台日誌。會顯示不同的圖示來表示主控台日誌是來自瀏覽器還是測試檔案。

![showing log of tests in trace viewer](https://github.com/microsoft/playwright/assets/13063165/4107c08d-1eaf-421c-bdd4-9dd2aa641d4a)

在動作側邊欄中雙擊測試中的動作。這將篩選主控台以僅顯示該動作期間產生的日誌。點擊 *Show all* 按鈕可再次查看所有主控台日誌。

使用時間軸篩選動作，方法是點擊起始點並拖動到結束點。主控台分頁也會被篩選為僅顯示所選動作期間產生的日誌。

### Network

Network 分頁顯示測試期間產生的所有網路請求。您可以按請求的不同類型、狀態碼、方法、請求、內容類型、持續時間和大小進行排序。點擊請求可查看更多相關資訊，例如請求標頭、回應標頭、請求內文和回應內文。

![network requests tab in trace viewer](https://github.com/microsoft/playwright/assets/13063165/0a3d1671-8ccd-4f7a-a844-35f5eb37f236)

在動作側邊欄中雙擊測試中的動作。這將篩選網路請求以僅顯示該動作期間產生的請求。點擊 *Show all* 按鈕可再次查看所有網路請求。

使用時間軸篩選動作，方法是點擊起始點並拖動到結束點。網路分頁也會被篩選為僅顯示所選動作期間產生的網路請求。

### Metadata

在 Actions 分頁旁邊，您會找到 Metadata 分頁，該分頁會顯示更多有關測試的資訊，例如瀏覽器、檢視區大小、測試持續時間等。

![meta data in trace viewer](https://github.com/microsoft/playwright/assets/13063165/82ab3d33-1ec9-4b8a-9cf2-30a6e2d59091)

### Attachments

"Attachments" 分頁允許您探索附件。如果您在進行[視覺回歸測試](./test-snapshots.mdx)，您將能夠透過檢查影像差異、實際影像和預期影像來比較螢幕截圖。當您點擊預期影像時，您可以使用滑桿將一個影像滑動到另一個影像上，這樣您可以輕鬆查看螢幕截圖中的差異。

![attachments tab in trace viewer](https://github.com/microsoft/playwright/assets/13063165/4386178a-5808-4fa8-9436-315350a23b04)


[Accessibility]: /api/class-accessibility.mdx "Accessibility"
[Android]: /api/class-android.mdx "Android"
[AndroidDevice]: /api/class-androiddevice.mdx "AndroidDevice"
[AndroidInput]: /api/class-androidinput.mdx "AndroidInput"
[AndroidSocket]: /api/class-androidsocket.mdx "AndroidSocket"
[AndroidWebView]: /api/class-androidwebview.mdx "AndroidWebView"
[APIRequest]: /api/class-apirequest.mdx "APIRequest"
[APIRequestContext]: /api/class-apirequestcontext.mdx "APIRequestContext"
[APIResponse]: /api/class-apiresponse.mdx "APIResponse"
[APIResponseAssertions]: /api/class-apiresponseassertions.mdx "APIResponseAssertions"
[Browser]: /api/class-browser.mdx "Browser"
[BrowserContext]: /api/class-browsercontext.mdx "BrowserContext"
[BrowserServer]: /api/class-browserserver.mdx "BrowserServer"
[BrowserType]: /api/class-browsertype.mdx "BrowserType"
[CDPSession]: /api/class-cdpsession.mdx "CDPSession"
[Clock]: /api/class-clock.mdx "Clock"
[ConsoleMessage]: /api/class-consolemessage.mdx "ConsoleMessage"
[Coverage]: /api/class-coverage.mdx "Coverage"
[Dialog]: /api/class-dialog.mdx "Dialog"
[Download]: /api/class-download.mdx "Download"
[Electron]: /api/class-electron.mdx "Electron"
[ElectronApplication]: /api/class-electronapplication.mdx "ElectronApplication"
[ElementHandle]: /api/class-elementhandle.mdx "ElementHandle"
[FileChooser]: /api/class-filechooser.mdx "FileChooser"
[Frame]: /api/class-frame.mdx "Frame"
[FrameLocator]: /api/class-framelocator.mdx "FrameLocator"
[GenericAssertions]: /api/class-genericassertions.mdx "GenericAssertions"
[JSHandle]: /api/class-jshandle.mdx "JSHandle"
[Keyboard]: /api/class-keyboard.mdx "Keyboard"
[Locator]: /api/class-locator.mdx "Locator"
[LocatorAssertions]: /api/class-locatorassertions.mdx "LocatorAssertions"
[Logger]: /api/class-logger.mdx "Logger"
[Mouse]: /api/class-mouse.mdx "Mouse"
[Page]: /api/class-page.mdx "Page"
[PageAssertions]: /api/class-pageassertions.mdx "PageAssertions"
[Playwright]: /api/class-playwright.mdx "Playwright"
[PlaywrightAssertions]: /api/class-playwrightassertions.mdx "PlaywrightAssertions"
[Request]: /api/class-request.mdx "Request"
[Response]: /api/class-response.mdx "Response"
[Route]: /api/class-route.mdx "Route"
[Selectors]: /api/class-selectors.mdx "Selectors"
[SnapshotAssertions]: /api/class-snapshotassertions.mdx "SnapshotAssertions"
[TimeoutError]: /api/class-timeouterror.mdx "TimeoutError"
[Touchscreen]: /api/class-touchscreen.mdx "Touchscreen"
[Tracing]: /api/class-tracing.mdx "Tracing"
[Video]: /api/class-video.mdx "Video"
[WebError]: /api/class-weberror.mdx "WebError"
[WebSocket]: /api/class-websocket.mdx "WebSocket"
[WebSocketRoute]: /api/class-websocketroute.mdx "WebSocketRoute"
[Worker]: /api/class-worker.mdx "Worker"
[Fixtures]: /api/class-fixtures.mdx "Fixtures"
[FullConfig]: /api/class-fullconfig.mdx "FullConfig"
[FullProject]: /api/class-fullproject.mdx "FullProject"
[Location]: /api/class-location.mdx "Location"
[Test]: /api/class-test.mdx "Test"
[TestConfig]: /api/class-testconfig.mdx "TestConfig"
[TestInfo]: /api/class-testinfo.mdx "TestInfo"
[TestInfoError]: /api/class-testinfoerror.mdx "TestInfoError"
[TestOptions]: /api/class-testoptions.mdx "TestOptions"
[TestProject]: /api/class-testproject.mdx "TestProject"
[TestStepInfo]: /api/class-teststepinfo.mdx "TestStepInfo"
[WorkerInfo]: /api/class-workerinfo.mdx "WorkerInfo"
[Reporter]: /api/class-reporter.mdx "Reporter"
[Suite]: /api/class-suite.mdx "Suite"
[TestCase]: /api/class-testcase.mdx "TestCase"
[TestError]: /api/class-testerror.mdx "TestError"
[TestResult]: /api/class-testresult.mdx "TestResult"
[TestStep]: /api/class-teststep.mdx "TestStep"
[Element]: https://developer.mozilla.org/en-US/docs/Web/API/element "Element"
[EvaluationArgument]: /evaluating.mdx#evaluation-argument "EvaluationArgument"
[Promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise "Promise"
[iterator]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols "Iterator"
[origin]: https://developer.mozilla.org/en-US/docs/Glossary/Origin "Origin"
[selector]: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors "selector"
[Serializable]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Description "Serializable"
[UIEvent.detail]: https://developer.mozilla.org/en-US/docs/Web/API/UIEvent/detail "UIEvent.detail"
[UnixTime]: https://en.wikipedia.org/wiki/Unix_time "Unix Time"
[xpath]: https://developer.mozilla.org/en-US/docs/Web/XPath "xpath"

[Array]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array "Array"
[boolean]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type "Boolean"
[Buffer]: https://nodejs.org/api/buffer.html#buffer_class_buffer "Buffer"
[ChildProcess]: https://nodejs.org/api/child_process.html "ChildProcess"
[Date]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date "Date"
[Error]: https://nodejs.org/api/errors.html#errors_class_error "Error"
[EventEmitter]: https://nodejs.org/api/events.html#events_class_eventemitter "EventEmitter"
[function]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function "Function"
[FormData]: https://developer.mozilla.org/en-US/docs/Web/API/FormData "FormData"
[Map]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map "Map"
[Metadata]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object "Object&lt;string, any&gt;"
[null]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/null "null"
[number]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type "Number"
[Object]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object "Object"
[Promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise "Promise"
[Readable]: https://nodejs.org/api/stream.html#stream_class_stream_readable "Readable"
[ReadStream]: https://nodejs.org/api/fs.html#class-fsreadstream "ReadStream"
[RegExp]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp "RegExp"
[string]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type "string"
[void]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined "void"
[URL]: https://nodejs.org/api/url.html "URL"
[URLSearchParams]: https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams "URLSearchParams"

[all available image tags]: https://mcr.microsoft.com/en-us/product/playwright/about "all available image tags"
[Microsoft Artifact Registry]: https://mcr.microsoft.com/en-us/product/playwright/about "Microsoft Artifact Registry"
[Dockerfile.noble]: https://github.com/microsoft/playwright/blob/main/utils/docker/Dockerfile.noble "Dockerfile.noble"
